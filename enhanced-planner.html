<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Study Planner - King's College London</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #e52d27 0%, #b31217 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 24px;
            box-shadow: 0 30px 90px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #e52d27 0%, #b31217 100%);
            color: white;
            padding: 60px 40px;
            text-align: center;
        }
        .header h1 { font-size: 36px; margin-bottom: 12px; font-weight: 700; }
        .header .subtitle { font-size: 18px; opacity: 0.95; }
        .header .uni-name { margin-top: 15px; font-size: 13px; font-weight: 600; letter-spacing: 2px; opacity: 0.85; }
        .content { padding: 50px 40px; }
        .intro-text {
            background: #f8f9fa;
            padding: 24px;
            border-radius: 12px;
            margin-bottom: 30px;
            border-left: 4px solid #e52d27;
            color: #495057;
            line-height: 1.7;
        }
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-bottom: 30px;
        }
        .input-group { position: relative; }
        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #212529;
            font-size: 15px;
        }
        select, input[type="number"] {
            width: 100%;
            padding: 16px;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
            font-weight: 500;
        }
        select:focus, input[type="number"]:focus {
            outline: none;
            border-color: #e52d27;
            box-shadow: 0 0 0 4px rgba(229, 45, 39, 0.1);
        }
        .helper-text { font-size: 13px; color: #6c757d; margin-top: 6px; }
        .work-schedule-insight {
            background: linear-gradient(135deg, #e8f4f8 0%, #d4e9f2 100%);
            padding: 16px;
            border-radius: 8px;
            margin-top: 10px;
            border-left: 3px solid #17a2b8;
            font-size: 14px;
            color: #0c5460;
            font-weight: 500;
        }
        .calculate-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #e52d27 0%, #b31217 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
            box-shadow: 0 8px 20px rgba(229, 45, 39, 0.25);
        }
        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 30px rgba(229, 45, 39, 0.35);
        }
        .results {
            margin-top: 40px;
            display: none;
            animation: fadeInUp 0.6s ease-out;
        }
        .results.show { display: block; }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .results-header { text-align: center; margin-bottom: 40px; }
        .results-header h2 { font-size: 32px; color: #212529; margin-bottom: 8px; font-weight: 700; }
        .stats-showcase {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 40px;
        }
        .stat-box {
            background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
            padding: 24px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }
        .stat-box:hover {
            border-color: #e52d27;
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.08);
        }
        .stat-label {
            font-size: 12px;
            color: #6c757d;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }
        .stat-value { font-size: 36px; font-weight: 800; color: #e52d27; }
        .schedule-insight-box {
            background: linear-gradient(135deg, #fff9e6 0%, #ffeaa7 100%);
            padding: 30px;
            border-radius: 16px;
            margin-bottom: 40px;
            border-left: 6px solid #ffc107;
        }
        .schedule-insight-title {
            font-size: 20px;
            font-weight: 700;
            color: #856404;
            margin-bottom: 16px;
        }
        .schedule-insight-content { color: #856404; line-height: 1.7; font-size: 15px; }
        .time-slots {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 20px;
        }
        .time-slot {
            background: white;
            padding: 16px;
            border-radius: 10px;
            border: 2px solid #ffc107;
            text-align: center;
        }
        .time-slot-label {
            font-size: 12px;
            color: #856404;
            font-weight: 600;
            margin-bottom: 8px;
            text-transform: uppercase;
        }
        .time-slot-value { font-size: 20px; font-weight: 700; color: #856404; }
        .visualization-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }
        .chart-container { background: #f8f9fa; padding: 30px; border-radius: 16px; }
        .chart-title {
            font-size: 16px;
            font-weight: 700;
            color: #212529;
            margin-bottom: 20px;
            text-align: center;
        }
        .chart-wrapper { position: relative; height: 280px; }
        .recommendation {
            background: linear-gradient(135deg, #fff5f5 0%, #ffe8e8 100%);
            padding: 35px;
            border-radius: 16px;
            border-left: 6px solid #e52d27;
            margin-bottom: 30px;
        }
        .recommendation-title {
            font-size: 24px;
            font-weight: 700;
            color: #e52d27;
            margin-bottom: 16px;
        }
        .recommendation-text { color: #495057; line-height: 1.8; font-size: 15px; }
        .recommendation-text strong { color: #e52d27; font-weight: 600; }
        .programme-suggestions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .programme-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #e52d27;
            transition: all 0.3s ease;
        }
        .programme-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(229, 45, 39, 0.2);
        }
        .programme-name { font-size: 16px; font-weight: 700; color: #e52d27; margin-bottom: 8px; }
        .programme-details { font-size: 14px; color: #495057; line-height: 1.6; }
        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-top: 40px;
        }
        .btn {
            padding: 16px 24px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            text-align: center;
        }
        .btn-primary {
            background: linear-gradient(135deg, #e52d27 0%, #b31217 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(229, 45, 39, 0.25);
        }
        .btn-primary:hover { transform: translateY(-2px); }
        .btn-secondary {
            background: white;
            color: #e52d27;
            border: 2px solid #e52d27;
        }
        .btn-secondary:hover { background: #e52d27; color: white; }
        @media (max-width: 768px) {
            .stats-showcase { grid-template-columns: repeat(2, 1fr); }
            .visualization-grid { grid-template-columns: 1fr; }
            .time-slots { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Smart Study Planner</h1>
            <div class="subtitle">Realistic recommendations for your actual schedule</div>
            <div class="uni-name">KING'S COLLEGE LONDON</div>
        </div>
        
        <div class="content">
            <div class="intro-text">
                <p><strong>Get realistic study recommendations.</strong> Our smart system accounts for commute time, rest, and meal preparation to give you achievable study windows.</p>
            </div>
            
            <form id="calculatorForm">
                <div class="form-grid">
                    <div class="input-group">
                        <label>Work & Commute Schedule</label>
                        <select id="workSchedule">
                            <option value="custom">Custom hours per week</option>
                            <option value="20">Part-time: 9am-1pm (20 hrs/week)</option>
                            <option value="25">Part-time: 9am-2pm (25 hrs/week)</option>
                            <option value="30">Part-time: 9am-3pm (30 hrs/week)</option>
                            <option value="40" selected>Standard: 9am-5pm (40 hrs/week)</option>
                            <option value="45">Extended: 8am-5pm (45 hrs/week)</option>
                            <option value="50">Extended: 7am-5pm or 8am-6pm (50 hrs/week)</option>
                            <option value="55">Long hours: 7am-6pm (55 hrs/week)</option>
                            <option value="60">Long hours: 7am-7pm (60 hrs/week)</option>
                        </select>
                        <input type="number" id="work" min="0" max="168" value="40" required style="display: none;">
                        <div class="helper-text">Select your typical work schedule</div>
                        <div id="workInsight" class="work-schedule-insight" style="display: none;"></div>
                    </div>
                    
                    <div class="input-group">
                        <label>Sleep Schedule</label>
                        <select id="sleepSchedule">
                            <option value="custom">Custom hours per week</option>
                            <option value="35">Short: 11:30pm-6:30am (35 hrs/week)</option>
                            <option value="42">Light: 11pm-6am (42 hrs/week)</option>
                            <option value="49" selected>Average: 10:30pm-6am (49 hrs/week)</option>
                            <option value="56">Good: 10pm-6am (56 hrs/week)</option>
                            <option value="63">Extended: 9:30pm-6am (63 hrs/week)</option>
                        </select>
                        <input type="number" id="sleep" min="0" max="168" value="49" required style="display: none;">
                        <div class="helper-text">Select your sleep pattern</div>
                        <div id="sleepInsight" class="work-schedule-insight" style="display: none;"></div>
                    </div>
                    
                    <div class="input-group">
                        <label>Meals & Food Prep (hours/week)</label>
                        <input type="number" id="meals" min="0" max="168" value="14" required>
                        <div class="helper-text">Cooking, eating, shopping</div>
                    </div>
                    
                    <div class="input-group">
                        <label>Family Commitments (hours/week)</label>
                        <input type="number" id="family" min="0" max="168" value="20" required>
                        <div class="helper-text">Childcare, household duties</div>
                    </div>
                    
                    <div class="input-group">
                        <label>Social & Leisure (hours/week)</label>
                        <input type="number" id="social" min="0" max="168" value="25" required>
                        <div class="helper-text">Friends, hobbies, exercise</div>
                    </div>
                    
                    <div class="input-group">
                        <label>Other Commitments (hours/week)</label>
                        <input type="number" id="other" min="0" max="168" value="10" required>
                        <div class="helper-text">Appointments, errands</div>
                    </div>
                </div>
                
                <button type="submit" class="calculate-btn">Generate Smart Study Plan</button>
            </form>
            
            <div id="results" class="results">
                <div class="results-header">
                    <h2>Your Realistic Study Plan</h2>
                    <p>Based on your actual schedule</p>
                </div>
                
                <div class="stats-showcase">
                    <div class="stat-box">
                        <div class="stat-label">Weekly</div>
                        <div class="stat-value" id="weeklyHours">0h</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Daily Avg</div>
                        <div class="stat-value" id="dailyHours">0h</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Monthly</div>
                        <div class="stat-value" id="monthlyHours">0h</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Yearly</div>
                        <div class="stat-value" id="yearlyHours">0h</div>
                    </div>
                </div>
                
                <div id="scheduleInsightBox" class="schedule-insight-box"></div>
                
                <div class="visualization-grid">
                    <div class="chart-container">
                        <div class="chart-title">Weekly Time Allocation</div>
                        <div class="chart-wrapper">
                            <canvas id="pieChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="chart-container">
                        <div class="chart-title">Available vs Committed</div>
                        <div class="chart-wrapper">
                            <canvas id="barChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="recommendation">
                    <div class="recommendation-title" id="recommendationTitle">Programme Recommendations</div>
                    <div class="recommendation-text" id="recommendationText"></div>
                    <div id="programmeSuggestions" class="programme-suggestions"></div>
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="window.print()">Download PDF</button>
                    <button class="btn btn-secondary" onclick="alert('Contact: admissions@kcl.ac.uk')">Contact Us</button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let pieChart, barChart;
        const workInput = document.getElementById('work');
        const workScheduleSelect = document.getElementById('workSchedule');
        const workInsight = document.getElementById('workInsight');
        const sleepInput = document.getElementById('sleep');
        const sleepScheduleSelect = document.getElementById('sleepSchedule');
        const sleepInsight = document.getElementById('sleepInsight');
        
        workScheduleSelect.addEventListener('change', function() {
            if (this.value === 'custom') {
                workInput.style.display = 'block';
            } else {
                workInput.style.display = 'none';
                workInput.value = this.value;
                updateWorkInsight(parseFloat(this.value));
            }
        });
        
        sleepScheduleSelect.addEventListener('change', function() {
            if (this.value === 'custom') {
                sleepInput.style.display = 'block';
            } else {
                sleepInput.style.display = 'none';
                sleepInput.value = this.value;
                updateSleepInsight(parseFloat(this.value));
            }
        });
        
        updateWorkInsight(40);
        updateSleepInsight(49);
        
        function updateWorkInsight(weeklyHours) {
            const dailyAvg = (weeklyHours / 5).toFixed(1);
            const schedule = analyzeWorkSchedule(dailyAvg);
            workInsight.style.display = 'block';
            workInsight.innerHTML = `💡 ${dailyAvg} hrs/day - ${schedule.type} (${schedule.range})`;
        }
        
        function updateSleepInsight(weeklyHours) {
            const dailyAvg = (weeklyHours / 7).toFixed(1);
            const sleepSchedule = analyzeSleepSchedule(dailyAvg);
            sleepInsight.style.display = 'block';
            sleepInsight.innerHTML = `💤 ${dailyAvg} hrs/night (${sleepSchedule.pattern})`;
        }
        
        function analyzeWorkSchedule(dailyHours) {
            if (dailyHours <= 4) return { type: 'part-time', range: '9am-1pm', morningStudy: true, eveningStudy: true };
            if (dailyHours <= 6) return { type: 'reduced', range: '9am-3pm', morningStudy: false, eveningStudy: true };
            if (dailyHours <= 8) return { type: 'standard', range: '9am-5pm', morningStudy: false, eveningStudy: true };
            if (dailyHours <= 10) return { type: 'extended', range: '8am-6pm', morningStudy: false, eveningStudy: true };
            return { type: 'long hours', range: '7am-7pm', morningStudy: false, eveningStudy: false };
        }
        
        function analyzeSleepSchedule(dailyHours) {
            if (dailyHours <= 5) return { pattern: '12am-5am', bedtime: '12:00am', wakeup: '5:00am' };
            if (dailyHours <= 6) return { pattern: '11:30pm-5:30am', bedtime: '11:30pm', wakeup: '5:30am' };
            if (dailyHours <= 7) return { pattern: '11pm-6am', bedtime: '11:00pm', wakeup: '6:00am' };
            if (dailyHours <= 8) return { pattern: '10:30pm-6:30am', bedtime: '10:30pm', wakeup: '6:30am' };
            return { pattern: '10pm-6am', bedtime: '10:00pm', wakeup: '6:00am' };
        }
        
        document.getElementById('calculatorForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const work = parseFloat(workInput.value);
            const sleep = parseFloat(sleepInput.value);
            const meals = parseFloat(document.getElementById('meals').value);
            const family = parseFloat(document.getElementById('family').value);
            const social = parseFloat(document.getElementById('social').value);
            const other = parseFloat(document.getElementById('other').value);
            
            const totalCommitted = work + sleep + meals + family + social + other;
            let available = 168 - totalCommitted;
            if (available < 0) available = 0;
            
            const perDay = (available / 7).toFixed(1);
            const perMonth = (available * 4.33).toFixed(0);
            const perYear = (available * 52).toFixed(0);
            
            const dailyWork = (work / 5).toFixed(1);
            const dailySleep = (sleep / 7).toFixed(1);
            const workSchedule = analyzeWorkSchedule(dailyWork);
            const sleepSchedule = analyzeSleepSchedule(dailySleep);
            
            document.getElementById('weeklyHours').textContent = available.toFixed(0) + 'h';
            document.getElementById('dailyHours').textContent = perDay + 'h';
            document.getElementById('monthlyHours').textContent = perMonth + 'h';
            document.getElementById('yearlyHours').textContent = perYear + 'h';
            
            createScheduleInsight(workSchedule, sleepSchedule, dailyWork, dailySleep);
            createCharts(work, sleep, meals, family, social, other, available);
            generateRecommendation(available, perYear, workSchedule);
            
            document.getElementById('results').classList.add('show');
            setTimeout(() => {
                document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
            }, 100);
        });
        
        function createScheduleInsight(workSchedule, sleepSchedule, dailyWork, dailySleep) {
            // FIX 1: Calculate actual work end time for ANY hours (including 12+)
            let workEndHour;
            if (dailyWork <= 4) {
                workEndHour = 13; // 9am + 4hrs = 1pm
            } else if (dailyWork <= 6) {
                workEndHour = 15; // 9am + 6hrs = 3pm
            } else if (dailyWork <= 8) {
                workEndHour = 17; // 9am + 8hrs = 5pm
            } else if (dailyWork <= 10) {
                workEndHour = 18; // 8am + 10hrs = 6pm
            } else if (dailyWork <= 12) {
                workEndHour = 19; // 7am + 12hrs = 7pm
            } else {
                // FIX 2: Handle very long work days (12+ hours)
                workEndHour = 19 + (dailyWork - 12); // 7am + 14hrs = 9pm, etc.
            }
            
            // Adjust buffer based on work hours
            let buffer, bufferDesc;
            if (dailyWork <= 4) {
                buffer = 1.5;
                bufferDesc = '1.5 hours (short commute 30min + lunch 45min + settling 15min)';
            } else if (dailyWork <= 6) {
                buffer = 1.75;
                bufferDesc = '1.75 hours (commute 40min + early dinner 60min + settling 15min)';
            } else if (dailyWork <= 8) {
                buffer = 2.25;
                bufferDesc = '2+ hours (commute 45min + dinner 60min + decompression 15min)';
            } else if (dailyWork <= 10) {
                buffer = 2.5;
                bufferDesc = '2.5 hours (longer commute 60min + dinner 60min + rest 20min)';
            } else {
                buffer = 2.75;
                bufferDesc = '2.75 hours (long commute + dinner + recovery)';
            }
            
            const studyStartHour = workEndHour + buffer;
            
            // FIX 3: Properly parse bedtime including midnight and half-hours
            const bedtimeStr = sleepSchedule.bedtime;
            const bedHourRaw = parseInt(bedtimeStr.split(':')[0]);
            const bedMinutes = bedtimeStr.includes(':30') ? 0.5 : 0;
            
            let actualBedHour;
            if (bedtimeStr.includes('am')) {
                if (bedHourRaw === 12) {
                    // 12:00am = midnight = 24 (next day for calculation)
                    actualBedHour = 24;
                } else {
                    // 1am-11am (shouldn't happen for bedtime, but handle it)
                    actualBedHour = bedHourRaw + 24; // Next day
                }
            } else { // pm
                if (bedHourRaw === 12) {
                    actualBedHour = 12; // Noon (shouldn't happen for bedtime)
                } else {
                    actualBedHour = bedHourRaw + 12; // 9pm = 21, 10pm = 22, 11pm = 23
                }
            }
            
            // FIX 4: Factor in half-hour bedtimes
            actualBedHour += bedMinutes;
            
            // Study ends 1 hour before bedtime for wind-down
            const studyEndHour = actualBedHour - 1;
            
            const formatTime = (h) => {
                let hour24 = Math.floor(h);
                const minutes = Math.round((h % 1) * 60);
                
                // Handle next-day hours (24+)
                if (hour24 >= 24) hour24 -= 24;
                
                const period = hour24 >= 12 ? 'pm' : 'am';
                let displayHour = hour24 > 12 ? hour24 - 12 : hour24;
                if (displayHour === 0) displayHour = 12;
                return `${displayHour}:${minutes.toString().padStart(2, '0')}${period}`;
            };
            
            const eveningAvailable = studyEndHour - studyStartHour;
            let eveningSlot = '';
            let studyTimeDesc = '';
            
            // FIX 5: Handle negative/zero study time gracefully
            if (eveningAvailable < 0) {
                eveningSlot = `<div class="time-slot" style="opacity: 0.4; background: #ffebee;"><div class="time-slot-label">Evening Study</div><div class="time-slot-value">Not possible</div></div>`;
                studyTimeDesc = `<strong>⚠️ Your work hours make evening study impossible.</strong> After ${dailyWork} hrs work + commute/dinner/rest, it's already past your bedtime. <strong>Weekend-only study</strong> is essential.`;
            } else if (eveningAvailable < 0.5) {
                eveningSlot = `<div class="time-slot" style="opacity: 0.6;"><div class="time-slot-label">Evening Study</div><div class="time-slot-value">< 30 min</div></div>`;
                studyTimeDesc = `Minimal evening time (under 30 minutes). <strong>Focus entirely on weekend study blocks.</strong>`;
            } else if (workSchedule.eveningStudy && eveningAvailable >= 1) {
                // FIX 6: Warn about very late study starts
                const warningText = studyStartHour >= 22 ? ' ⚠️ Very late start - consider weekend focus instead' : '';
                eveningSlot = `<div class="time-slot"><div class="time-slot-label">Evening Study</div><div class="time-slot-value">${formatTime(studyStartHour)}-${formatTime(studyEndHour)}</div></div>`;
                studyTimeDesc = `Best study window: <strong>evenings (${formatTime(studyStartHour)}-${formatTime(studyEndHour)})</strong>, allowing ${bufferDesc}${warningText}`;
            } else if (workSchedule.eveningStudy) {
                eveningSlot = `<div class="time-slot" style="opacity: 0.6;"><div class="time-slot-label">Evening Study</div><div class="time-slot-value">Limited</div></div>`;
                studyTimeDesc = `Very limited evening time. <strong>Focus on weekend-intensive learning</strong>`;
            } else {
                studyTimeDesc = `With your demanding schedule, <strong>weekend-focused learning</strong> works best`;
            }
            
            // FIX 7: Use actual wake-up time for morning study slot
            const wakeTime = sleepSchedule.wakeup;
            const wakeHour = parseInt(wakeTime.split(':')[0]);
            const wakeMinutes = wakeTime.includes(':30') ? ':30' : ':00';
            const morningStudyStart = `${wakeHour}${wakeMinutes}${wakeTime.includes('am') ? 'am' : 'pm'}`;
            
            const morningSlot = workSchedule.morningStudy ? 
                `<div class="time-slot"><div class="time-slot-label">Morning Study</div><div class="time-slot-value">${morningStudyStart}-8:30am</div></div>` : '';
            
            const lunchSlot = dailyWork >= 7 ? 
                `<div class="time-slot"><div class="time-slot-label">Lunch Break</div><div class="time-slot-value">30-45 min</div></div>` : '';
            
            let proTip = '';
            if (eveningAvailable < 0) {
                proTip = `Your schedule requires weekend-only study. Plan Saturday & Sunday 9am-5pm blocks (16 hours/weekend).`;
            } else if (eveningAvailable >= 3) {
                proTip = `You have ${eveningAvailable.toFixed(1)} hours each evening - excellent! Use 2 hours for deep study, 1 hour for review.`;
            } else if (eveningAvailable >= 2) {
                proTip = `You have ${eveningAvailable.toFixed(1)} hours each evening - use first hour for lighter study, save complex work for weekends.`;
            } else if (eveningAvailable >= 1) {
                proTip = `Only ${eveningAvailable.toFixed(1)} hours on weekday evenings - plan 3-4 hour weekend blocks for major assignments.`;
            } else {
                proTip = `Weekend 3-4 hour blocks (Sat/Sun 9am-1pm) will be most productive given your limited weekday time.`;
            }
            
            document.getElementById('scheduleInsightBox').innerHTML = `
                <div class="schedule-insight-title">⏰ Your Realistic Study Schedule</div>
                <div class="schedule-insight-content">
                    <p><strong>Work:</strong> ${dailyWork} hrs/day (${workSchedule.type}, ${workSchedule.range}) | <strong>Sleep:</strong> ${dailySleep} hrs/night (${sleepSchedule.bedtime} - ${sleepSchedule.wakeup})</p>
                    <p style="margin-top: 12px;">${studyTimeDesc}</p>
                    <div class="time-slots">
                        ${morningSlot}
                        ${lunchSlot}
                        ${eveningSlot}
                        <div class="time-slot"><div class="time-slot-label">Weekend Study</div><div class="time-slot-value">Flexible blocks</div></div>
                    </div>
                    <p style="margin-top: 16px; font-size: 14px;"><strong>💡 Pro Tip:</strong> ${proTip}</p>
                </div>
            `;
        }
        
        function createCharts(work, sleep, meals, family, social, other, available) {
            const pieCtx = document.getElementById('pieChart').getContext('2d');
            const barCtx = document.getElementById('barChart').getContext('2d');
            
            if (pieChart) pieChart.destroy();
            if (barChart) barChart.destroy();
            
            pieChart = new Chart(pieCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Work', 'Sleep', 'Meals', 'Family', 'Social', 'Other', 'Study'],
                    datasets: [{
                        data: [work, sleep, meals, family, social, other, available],
                        backgroundColor: ['#e52d27', '#6c757d', '#fd7e14', '#ff6b6b', '#ffc107', '#96ceb4', '#28a745'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { padding: 10, font: { size: 10, weight: '600' }, boxWidth: 12 }
                        }
                    }
                }
            });
            
            const totalCommitted = work + sleep + meals + family + social + other;
            barChart = new Chart(barCtx, {
                type: 'bar',
                data: {
                    labels: ['Available', 'Committed'],
                    datasets: [{
                        label: 'Hours/Week',
                        data: [available, totalCommitted],
                        backgroundColor: ['#28a745', '#dc3545'],
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: true, max: 168, grid: { color: '#e9ecef' } },
                        x: { grid: { display: false } }
                    }
                }
            });
        }
        
        function generateRecommendation(available, perYear, workSchedule) {
            let title = '';
            let text = '';
            let suggestions = [];
            
            if (available >= 20) {
                title = 'Excellent Capacity: Multiple Options';
                text = `<strong>Exceptional study capacity.</strong> With ${available.toFixed(0)} hours weekly (${perYear} annually), you could pursue full-time programmes or intensive part-time degrees.`;
                suggestions = [
                    { name: "Full-Time Master's", details: "Complete in 1 year", commitment: "20-25 hrs/week", format: "Campus or blended" },
                    { name: "Part-Time Master's + Certificate", details: "Dual credentials over 2 years", commitment: "15-20 hrs/week", format: "Evening/weekend" },
                    { name: "Research Programme", details: "MPhil/PhD", commitment: "20+ hrs/week", format: "Independent research" }
                ];
            } else if (available >= 12) {
                title = 'Strong Capacity: Part-Time Study';
                text = `<strong>Well-suited for part-time learning.</strong> ${available.toFixed(0)} hours weekly (${perYear} annually) aligns with part-time Master's programmes. ${workSchedule.eveningStudy ? 'Evening classes work well.' : 'Weekend formats recommended.'}`;
                suggestions = [
                    { name: "Part-Time Master's", details: "2-3 years completion", commitment: "12-15 hrs/week", format: workSchedule.eveningStudy ? "Evening & online" : "Weekend & online" },
                    { name: "Professional Certificates", details: "Stackable credentials", commitment: "10-12 hrs/week", format: "Self-paced online" },
                    { name: "Postgraduate Diploma", details: "Professional qualification", commitment: "12-14 hrs/week", format: "Blended learning" }
                ];
            } else if (available >= 7) {
                title = 'Good Capacity: Flexible Learning';
                text = `<strong>Supports flexible programmes.</strong> ${available.toFixed(0)} hours weekly (${perYear} annually). Executive education works well ${workSchedule.eveningStudy ? 'with evening study' : 'with weekend focus'}.`;
                suggestions = [
                    { name: "Executive Education", details: "For working professionals", commitment: "7-10 hrs/week", format: workSchedule.eveningStudy ? "Evening & weekend" : "Weekend intensive" },
                    { name: "Micro-Credentials", details: "8-12 week programmes", commitment: "6-8 hrs/week", format: "Flexible online" },
                    { name: "Professional Development", details: "Industry skills", commitment: "7-9 hrs/week", format: "Self-paced" }
                ];
            } else if (available >= 3) {
                title = 'Moderate Capacity: Micro-Learning';
                text = `<strong>Ideal for micro-learning.</strong> ${available.toFixed(0)} hours weekly (${perYear} annually). Short certificates fit your demanding schedule.`;
                suggestions = [
                    { name: "Short Courses", details: "4-8 week programmes", commitment: "3-5 hrs/week", format: "Fully online" },
                    { name: "Modular Learning", details: "One module at a time", commitment: "3-6 hrs/week", format: "Self-paced" }
                ];
            } else {
                title = 'Limited Capacity: Consider Adjustments';
                text = `<strong>Currently limited study time.</strong> With ${available.toFixed(0)} hours weekly, consider adjusting your schedule or ultra-flexible micro-learning.`;
                suggestions = [
                    { name: "Micro-Modules", details: "2-4 week bite-sized learning", commitment: "1-2 hrs/week", format: "Mobile-friendly" },
                    { name: "On-Demand Masterclasses", details: "Single-topic sessions", commitment: "1-3 hrs total", format: "Lifetime access" }
                ];
            }
            
            document.getElementById('recommendationTitle').textContent = title;
            document.getElementById('recommendationText').innerHTML = text;
            document.getElementById('programmeSuggestions').innerHTML = suggestions.map(s => `
                <div class="programme-card">
                    <div class="programme-name">${s.name}</div>
                    <div class="programme-details">
                        ${s.details}<br>
                        <strong>Time:</strong> ${s.commitment}<br>
                        <strong>Format:</strong> ${s.format}
                    </div>
                </div>
            `).join('');
        }
    </script>
</body>
</html>
