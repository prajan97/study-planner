<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Study Planner ‚Äî Student Time Management Tool</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=DM+Sans:wght@300;400;500;600&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  <style>
    :root {
      --accent: #1e3a5f;
      --accent-dark: #162d4a;
      --accent-mid: #2c5282;
      --accent-light: rgba(30,58,95,0.07);
      --accent-glow: rgba(30,58,95,0.18);
      --bg: #f4f5f7;
      --surface: #ffffff;
      --surface-2: #f0f2f5;
      --border: #dde1e7;
      --text: #111827;
      --text-2: #4b5563;
      --text-3: #9ca3af;
      --shadow: 0 4px 24px rgba(17,24,39,0.07);
      --shadow-lg: 0 12px 48px rgba(17,24,39,0.12);
      --r: 14px;
    }
    [data-theme="dark"] {
      --accent: #3b82f6;
      --accent-dark: #2563eb;
      --accent-mid: #60a5fa;
      --accent-light: rgba(59,130,246,0.1);
      --accent-glow: rgba(59,130,246,0.2);
      --bg: #0d1117;
      --surface: #161b22;
      --surface-2: #1c2230;
      --border: #262e3d;
      --text: #e6edf3;
      --text-2: #8b949e;
      --text-3: #4d5566;
      --shadow: 0 4px 24px rgba(0,0,0,0.4);
      --shadow-lg: 0 12px 48px rgba(0,0,0,0.5);
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: 'DM Sans', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      transition: background .3s, color .3s;
    }

    /* ‚îÄ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ‚îÄ */
    .header {
      background: var(--accent);
      position: relative;
      overflow: hidden;
      padding: 0;
    }
    .header::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, rgba(255,255,255,0.04) 0%, transparent 60%);
    }
    .header-inner {
      max-width: 1440px;
      margin: 0 auto;
      padding: 28px 40px 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: relative;
    }
    .logo-area { display: flex; align-items: center; gap: 14px; }
    .logo-mark {
      width: 40px; height: 40px;
      background: rgba(255,255,255,0.12);
      border-radius: 8px;
      display: grid; place-items: center;
      border: 1px solid rgba(255,255,255,0.18);
      flex-shrink: 0;
    }
    .logo-mark svg { width: 20px; height: 20px; }
    .logo-divider {
      width: 1px; height: 32px;
      background: rgba(255,255,255,0.2);
      margin: 0 2px;
    }
    .logo-text h1 {
      font-family: 'DM Sans', sans-serif;
      font-size: 18px;
      font-weight: 600;
      color: #fff;
      line-height: 1;
      letter-spacing: -0.2px;
    }
    .logo-text span {
      font-size: 11px;
      color: rgba(255,255,255,0.55);
      letter-spacing: 1.5px;
      text-transform: uppercase;
      font-weight: 500;
      display: block;
      margin-top: 4px;
    }
    .header-actions { display: flex; gap: 8px; align-items: center; }
    .hbtn {
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.18);
      color: rgba(255,255,255,0.85);
      padding: 8px 16px;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all .2s;
      font-family: 'DM Sans', sans-serif;
      letter-spacing: 0.2px;
    }
    .hbtn:hover { background: rgba(255,255,255,0.18); color: #fff; }
    .hbtn.icon { padding: 8px 12px; }

    /* ‚îÄ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ‚îÄ */
    .wrap {
      max-width: 1440px;
      margin: 0 auto;
      padding: 36px 40px;
      display: grid;
      grid-template-columns: 400px 1fr;
      gap: 28px;
      align-items: start;
    }
    @media (max-width: 1100px) { .wrap { grid-template-columns: 1fr; padding: 24px 20px; } }

    /* ‚îÄ‚îÄ‚îÄ PANELS ‚îÄ‚îÄ‚îÄ */
    .panel {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--r);
      padding: 32px;
      box-shadow: var(--shadow);
    }
    .panel-title {
      font-family: 'Playfair Display', serif;
      font-size: 22px;
      color: var(--text);
      margin-bottom: 6px;
    }
    .panel-sub { font-size: 13px; color: var(--text-3); margin-bottom: 28px; line-height: 1.5; }
    
    .left-panel { position: sticky; top: 28px; }

    /* ‚îÄ‚îÄ‚îÄ FORM ‚îÄ‚îÄ‚îÄ */
    .field { margin-bottom: 22px; }
    .field label {
      display: block;
      font-size: 12px;
      font-weight: 600;
      letter-spacing: 0.8px;
      text-transform: uppercase;
      color: var(--text-2);
      margin-bottom: 8px;
    }
    .field select, .field input[type="number"] {
      width: 100%;
      padding: 12px 14px;
      border: 1.5px solid var(--border);
      border-radius: 10px;
      font-size: 14px;
      font-family: 'DM Sans', sans-serif;
      background: var(--surface);
      color: var(--text);
      transition: border .2s, box-shadow .2s;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%23999' stroke-width='1.5' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 14px center;
      padding-right: 36px;
    }
    .field select:focus, .field input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px var(--accent-light);
    }
    .field-note { font-size: 11.5px; color: var(--text-3); margin-top: 5px; }

    /* Hybrid days checkboxes */
    .days-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; margin-top: 4px; }
    .day-chip {
      position: relative;
    }
    .day-chip input { position: absolute; opacity: 0; }
    .day-chip label {
      display: block;
      padding: 8px 0;
      text-align: center;
      border: 1.5px solid var(--border);
      border-radius: 8px;
      font-size: 12px;
      font-weight: 600;
      color: var(--text-2);
      cursor: pointer;
      transition: all .2s;
      letter-spacing: 0;
      text-transform: none;
      margin: 0;
    }
    .day-chip input:checked + label {
      background: var(--accent);
      border-color: var(--accent);
      color: #fff;
    }
    .day-chip label:hover { border-color: var(--accent); }

    /* Submit */
    .submit-btn {
      width: 100%;
      padding: 15px;
      background: var(--accent);
      color: #fff;
      border: none;
      border-radius: 10px;
      font-family: 'DM Sans', sans-serif;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all .2s;
      margin-top: 8px;
      letter-spacing: 0.3px;
    }
    .submit-btn:hover { background: var(--accent-dark); transform: translateY(-1px); box-shadow: 0 6px 20px rgba(30,58,95,0.3); }

    /* ‚îÄ‚îÄ‚îÄ OVERVIEW STRIP (header) ‚îÄ‚îÄ‚îÄ */
    .overview-strip {
      border-top: 1px solid rgba(255,255,255,0.15);
      margin-top: 18px;
      padding-top: 14px;
      display: none;
      flex-wrap: wrap;
      gap: 6px 0;
    }
    .overview-strip.show { display: flex; align-items: center; }
    .ov-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 0 20px;
      border-right: 1px solid rgba(255,255,255,0.18);
    }
    .ov-item:first-child { padding-left: 0; }
    .ov-item:last-child { border-right: none; }
    .ov-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
    .ov-val { font-family: 'DM Mono', monospace; font-size: 15px; font-weight: 500; color: #fff; line-height: 1; }
    .ov-lbl { font-size: 11px; color: rgba(255,255,255,0.6); font-weight: 500; margin-top: 2px; }
    .ov-free .ov-val { color: #7dffb3; }
    .ov-free .ov-lbl { color: rgba(125,255,179,0.75); }

    /* ‚îÄ‚îÄ‚îÄ STATS BAR (top of right panel, above grid) ‚îÄ‚îÄ‚îÄ */
    .stats-bar {
      display: none;
      grid-template-columns: repeat(8, 1fr);
      gap: 8px;
      margin-bottom: 20px;
      padding-bottom: 20px;
      border-bottom: 1px solid var(--border);
    }
    .stats-bar.show { display: grid; }
    .sbar-chip {
      background: var(--surface-2);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 9px 6px;
      text-align: center;
    }
    .sbar-chip .val { font-family: 'DM Mono', monospace; font-size: 15px; font-weight: 500; line-height: 1; }
    .sbar-chip .lbl { font-size: 9px; text-transform: uppercase; letter-spacing: 0.8px; color: var(--text-3); margin-top: 4px; font-weight: 600; }
    [data-theme="dark"] .sbar-chip .lbl { color: var(--text-2); }

    /* ‚îÄ‚îÄ‚îÄ CALENDAR AREA ‚îÄ‚îÄ‚îÄ */
    .right-panel { min-height: 600px; }
    .calendar-container { display: none; }
    .calendar-container.show { display: block; }

    .cal-toolbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 14px;
      margin-bottom: 20px;
      padding-bottom: 20px;
      border-bottom: 1px solid var(--border);
    }
    .paint-label {
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.8px;
      color: var(--text);
      margin-right: 10px;
    }
    #activitySelect {
      padding: 9px 32px 9px 12px;
      border: 1.5px solid var(--border);
      border-radius: 8px;
      font-size: 13px;
      font-family: 'DM Sans', sans-serif;
      background: var(--surface);
      color: var(--text);
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%23999' stroke-width='1.5' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 10px center;
      cursor: pointer;
      font-weight: 500;
    }
    #activitySelect:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 3px var(--accent-light); }
    .tbtn {
      padding: 9px 16px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      border: 1.5px solid var(--border);
      background: var(--surface);
      color: var(--text);
      font-family: 'DM Sans', sans-serif;
      transition: all .2s;
    }
    .tbtn:hover { border-color: var(--text-3); background: var(--surface-2); }
    .tbtn.primary { background: var(--accent); color: #fff; border-color: var(--accent); }
    .tbtn.primary:hover { background: var(--accent-dark); }

    /* Legend */
    .legend {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-bottom: 18px;
    }
    .legend-item { display: flex; align-items: center; gap: 6px; font-size: 12px; color: var(--text); font-weight: 500; }
    .leg-dot { width: 10px; height: 10px; border-radius: 2px; flex-shrink: 0; }

    /* Tip */
    .cal-tip {
      background: var(--surface-2);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 10px 14px;
      font-size: 12px;
      color: var(--text-2);
      margin-bottom: 16px;
      text-align: center;
    }

    /* ‚îÄ‚îÄ‚îÄ GRID ‚îÄ‚îÄ‚îÄ */
    .grid-wrap {
      border: 1px solid var(--border);
      border-radius: 10px;
      overflow: hidden;
      box-shadow: var(--shadow);
    }
    .weekly-grid {
      display: grid;
      grid-template-columns: 52px repeat(7, 1fr);
      grid-auto-rows: 20px;
      user-select: none;
    }
    .g-head {
      background: var(--surface-2);
      border-right: 1px solid var(--border);
      border-bottom: 1px solid var(--border);
      font-size: 10px;
      font-weight: 700;
      text-align: center;
      line-height: 20px;
      color: var(--text-3);
      letter-spacing: 0.5px;
      text-transform: uppercase;
    }
    .g-cell {
      border-right: 1px solid var(--border);
      border-bottom: 1px solid rgba(0,0,0,0.04);
      cursor: pointer;
      transition: background .1s;
      font-size: 9px;
      text-align: center;
      line-height: 20px;
      color: transparent;
    }
    [data-theme="dark"] .g-cell { border-bottom: 1px solid rgba(255,255,255,0.03); }
    .g-cell:hover:not(.is-work):not(.is-sleep):not(.is-commute) { background: var(--accent-light) !important; }
    .g-cell.is-study  { background: #2d9a57; color: rgba(255,255,255,0.6); }
    .g-cell.is-work   { background: #1e3a5f; cursor: not-allowed; }
    .g-cell.is-commute{ background: #e07b1a; cursor: not-allowed; }
    .g-cell.is-sleep  { background: #6b7280; cursor: not-allowed; }
    .g-cell.is-family { background: #e05a7a; color: rgba(255,255,255,0.6); }
    .g-cell.is-social { background: #c9981a; color: rgba(255,255,255,0.6); }
    .g-cell.is-other  { background: #5a9e82; color: rgba(255,255,255,0.6); }

    /* Placeholder */
    .placeholder {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 80px 20px;
      color: var(--text-3);
      gap: 16px;
      text-align: center;
    }
    .placeholder .icon {
      width: 72px; height: 72px;
      background: var(--surface-2);
      border-radius: 16px;
      display: grid; place-items: center;
      font-size: 30px;
      border: 1px solid var(--border);
    }
    .placeholder h3 { font-family: 'Playfair Display', serif; font-size: 20px; color: var(--text-2); }
    .placeholder p { font-size: 14px; max-width: 300px; line-height: 1.6; }

    /* Chart removed */

    /* Schedule info callout */
    .callout {
      background: var(--surface-2);
      border-left: 3px solid var(--accent);
      border-radius: 0 8px 8px 0;
      padding: 14px 16px;
      margin-top: 20px;
      font-size: 13px;
      color: var(--text-2);
      display: none;
      line-height: 1.7;
    }
    .callout.show { display: block; }
    .callout strong { color: var(--text); }

    /* ‚îÄ‚îÄ‚îÄ Dark mode explicit overrides ‚îÄ‚îÄ‚îÄ */
    [data-theme="dark"] .callout { color: var(--text-2); }
    [data-theme="dark"] .panel-sub { color: var(--text-2); }
    [data-theme="dark"] .field-note { color: var(--text-3); }
    [data-theme="dark"] .stat-chip .lbl { color: var(--text-2); }
    [data-theme="dark"] .g-head { color: var(--text-2); background: var(--surface-2); }
    [data-theme="dark"] #activitySelect { background-color: var(--surface-2); color: var(--text); border-color: var(--border); }
    [data-theme="dark"] .field select,
    [data-theme="dark"] .field input[type="number"] { background-color: var(--surface-2); color: var(--text); }
    [data-theme="dark"] .placeholder h3 { color: var(--text-2); }
    [data-theme="dark"] .placeholder p { color: var(--text-2); }
    [data-theme="dark"] .day-chip label { color: var(--text-2); }

    /* ‚îÄ‚îÄ‚îÄ Responsive ‚îÄ‚îÄ‚îÄ */
    @media (max-width: 700px) {
      .wrap { padding: 16px; gap: 16px; }
      .panel { padding: 20px; }
      .header-inner { padding: 20px; }
      .logo-text h1 { font-size: 20px; }
      .stats-row { grid-template-columns: repeat(4, 1fr); }
    }
  </style>
</head>
<body>

<!-- HEADER -->
<header class="header">
  <div class="header-inner">
    <div class="logo-area">
      <div class="logo-mark">
        <svg viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect x="2" y="3" width="16" height="15" rx="2" stroke="white" stroke-width="1.5"/>
          <path d="M2 7h16" stroke="white" stroke-width="1.5"/>
          <path d="M6 1v4M14 1v4" stroke="white" stroke-width="1.5" stroke-linecap="round"/>
          <rect x="5" y="10" width="3" height="3" rx="0.5" fill="white" opacity="0.7"/>
          <rect x="9" y="10" width="3" height="3" rx="0.5" fill="white" opacity="0.7"/>
          <rect x="5" y="14" width="3" height="2" rx="0.5" fill="white" opacity="0.5"/>
        </svg>
      </div>
      <div class="logo-divider"></div>
      <div class="logo-text">
        <h1>Study Planner</h1>
        <span>Student Time Management Tool</span>
      </div>
    </div>
    <div class="header-actions">
      <button class="hbtn" id="printBtn">Print</button>
      <button class="hbtn" id="downloadBtn">Download CSV</button>
      <button class="hbtn icon" id="themeBtn" title="Toggle theme">‚óê</button>
    </div>
  </div>
  <!-- Overview strip ‚Äî shown after generating -->
  <div style="max-width:1440px;margin:0 auto;padding:0 40px 20px;">
    <div class="overview-strip" id="overviewStrip">
      <div class="ov-item"><div class="ov-dot" style="background:rgba(255,255,255,0.5)"></div><div><div class="ov-val" id="ov-work">‚Äî</div><div class="ov-lbl">Work</div></div></div>
      <div class="ov-item"><div class="ov-dot" style="background:#e07b1a"></div><div><div class="ov-val" id="ov-commute">‚Äî</div><div class="ov-lbl">Commute</div></div></div>
      <div class="ov-item"><div class="ov-dot" style="background:#9ca3af"></div><div><div class="ov-val" id="ov-sleep">‚Äî</div><div class="ov-lbl">Sleep</div></div></div>
      <div class="ov-item ov-free"><div class="ov-dot" style="background:#7dffb3"></div><div><div class="ov-val" id="ov-free">‚Äî</div><div class="ov-lbl">Available / week</div></div></div>
    </div>
  </div>
</header>

<!-- MAIN -->
<div class="wrap">
  <!-- LEFT: Form -->
  <div class="panel left-panel">
    <div class="panel-title">Your Commitments</div>
    <p class="panel-sub">Enter your existing schedule to see realistic study windows generated around your life.</p>

    <form id="plannerForm">
      <div class="field">
        <label>Work Schedule</label>
        <select id="workSchedule" required>
          <option value="">‚Äî Select work hours ‚Äî</option>
          <option value="custom"    data-hours="15">Custom (~15 hrs/week)</option>
          <option value="part-time-20" data-hours="20">Part-time: 9am‚Äì1pm (20 hrs/week)</option>
          <option value="part-time-25" data-hours="25">Part-time: 9am‚Äì2pm (25 hrs/week)</option>
          <option value="part-time-30" data-hours="30">Part-time: 9am‚Äì3pm (30 hrs/week)</option>
          <option value="standard"  data-hours="40" selected>Standard: 9am‚Äì5pm (40 hrs/week)</option>
          <option value="extended-45" data-hours="45">Extended: 8am‚Äì5pm (45 hrs/week)</option>
          <option value="extended-50" data-hours="50">Extended: 7am‚Äì5pm (50 hrs/week)</option>
          <option value="long-55"   data-hours="55">Long: 7am‚Äì6pm (55 hrs/week)</option>
          <option value="long-60"   data-hours="60">Long: 7am‚Äì7pm (60 hrs/week)</option>
        </select>
        <div class="field-note">Core work hours, auto-scheduled Mon‚ÄìFri</div>
      </div>

      <div class="field">
        <label>Daily Commute</label>
        <select id="commuteSchedule" required>
          <option value="">‚Äî Select commute time ‚Äî</option>
          <option value="none"     data-hours="0">No commute (WFH / remote)</option>
          <option value="short"    data-hours="5">Short: 30 min total (5 hrs/week)</option>
          <option value="moderate" data-hours="7.5">Moderate: 45 min total (7.5 hrs/week)</option>
          <option value="standard" data-hours="10" selected>Standard: 1 hr total (10 hrs/week)</option>
          <option value="long"     data-hours="12.5">Long: 1.5 hrs total (12.5 hrs/week)</option>
          <option value="extended" data-hours="15">Extended: 2+ hrs total (15 hrs/week)</option>
        </select>
        <div class="field-note">Total daily travel to and from work</div>
      </div>

      <div class="field">
        <label>Work Arrangement</label>
        <select id="workArrangement">
          <option value="office">Full-time in office</option>
          <option value="hybrid-2">Hybrid: 2 days office, 3 WFH</option>
          <option value="hybrid-3">Hybrid: 3 days office, 2 WFH</option>
          <option value="remote">Fully remote</option>
        </select>
      </div>

      <div class="field" id="hybridField" style="display:none;">
        <label>Office Days</label>
        <div class="days-grid">
          <div class="day-chip"><input type="checkbox" id="d-mon" value="0"><label for="d-mon">Mon</label></div>
          <div class="day-chip"><input type="checkbox" id="d-tue" value="1"><label for="d-tue">Tue</label></div>
          <div class="day-chip"><input type="checkbox" id="d-wed" value="2" checked><label for="d-wed">Wed</label></div>
          <div class="day-chip"><input type="checkbox" id="d-thu" value="3" checked><label for="d-thu">Thu</label></div>
          <div class="day-chip"><input type="checkbox" id="d-fri" value="4"><label for="d-fri">Fri</label></div>
        </div>
        <div class="field-note">Select which days you travel in</div>
      </div>

      <div class="field">
        <label>Sleep Schedule</label>
        <select id="sleepSchedule" required>
          <option value="">‚Äî Select sleep pattern ‚Äî</option>
          <option value="short"    data-hours="35">Short: 11:30pm‚Äì6:30am (35 hrs/week)</option>
          <option value="light"    data-hours="42">Light: 11pm‚Äì6am (42 hrs/week)</option>
          <option value="average"  data-hours="49" selected>Average: 10:30pm‚Äì6am (49 hrs/week)</option>
          <option value="good"     data-hours="56">Good: 10pm‚Äì6am (56 hrs/week)</option>
          <option value="extended" data-hours="63">Extended: 9:30pm‚Äì6am (63 hrs/week)</option>
        </select>
        <div class="field-note">Auto-scheduled every night</div>
      </div>

      <button type="submit" class="submit-btn">Generate My Study Plan ‚Üí</button>
    </form>
  </div>

  <!-- RIGHT: Calendar -->
  <div class="panel right-panel">
    <div class="panel-title">Weekly Schedule</div>

    <!-- Placeholder -->
    <div class="placeholder" id="placeholder">
      <div class="icon">üìÖ</div>
      <h3>Your timetable will appear here</h3>
      <p>Fill in your commitments on the left and click <em>Generate My Study Plan</em> to see your available windows.</p>
    </div>

    <!-- Calendar -->
    <div class="calendar-container" id="calendarContainer">
      <!-- Weekly breakdown bar -->
      <div class="stats-bar" id="statsBar"></div>

      <!-- Legend -->
      <div class="legend">
        <div class="legend-item"><div class="leg-dot" style="background:#1e3a5f"></div>Work</div>
        <div class="legend-item"><div class="leg-dot" style="background:#e07b1a"></div>Commute</div>
        <div class="legend-item"><div class="leg-dot" style="background:#6b7280"></div>Sleep</div>
        <div class="legend-item"><div class="leg-dot" style="background:#2d9a57"></div>Study</div>
        <div class="legend-item"><div class="leg-dot" style="background:#e05a7a"></div>Family</div>
        <div class="legend-item"><div class="leg-dot" style="background:#c9981a"></div>Social</div>
        <div class="legend-item"><div class="leg-dot" style="background:#5a9e82"></div>Other</div>
      </div>

      <!-- Toolbar -->
      <div class="cal-toolbar">
        <div style="display:flex;align-items:center;gap:10px;">
          <span class="paint-label">Paint:</span>
          <select id="activitySelect">
            <option value="study">Study</option>
            <option value="family">Family</option>
            <option value="social">Social</option>
            <option value="other">Other</option>
          </select>
        </div>
        <div style="display:flex;gap:8px;">
          <button class="tbtn" id="clearBtn">Clear Personal</button>
          <button class="tbtn primary" id="smartBtn">‚ú¶ Smart Fill</button>
        </div>
      </div>

      <div class="cal-tip">Click or drag to paint time slots ¬∑ Right-click to erase</div>

      <!-- Grid -->
      <div class="grid-wrap">
        <div class="weekly-grid" id="weeklyGrid"></div>
      </div>
    </div>
  </div>
</div>

<script>
  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  //  STATE
  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  let isDragging = false;
  let currentActivity = 'study';

  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  //  THEME
  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const html = document.documentElement;
  function initTheme() {
    const saved = localStorage.getItem('kcl-theme') || 'light';
    html.setAttribute('data-theme', saved);
  }
  document.getElementById('themeBtn').addEventListener('click', () => {
    const next = html.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
    html.setAttribute('data-theme', next);
    localStorage.setItem('kcl-theme', next);
  });

  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  //  HYBRID DAYS TOGGLE
  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  document.getElementById('workArrangement').addEventListener('change', function() {
    const hybrid = document.getElementById('hybridField');
    if (this.value.startsWith('hybrid')) {
      hybrid.style.display = 'block';
      // preset checkboxes
      document.querySelectorAll('#hybridField input').forEach(cb => cb.checked = false);
      if (this.value === 'hybrid-2') {
        document.getElementById('d-wed').checked = true;
        document.getElementById('d-thu').checked = true;
      } else {
        document.getElementById('d-mon').checked = true;
        document.getElementById('d-wed').checked = true;
        document.getElementById('d-fri').checked = true;
      }
    } else {
      hybrid.style.display = 'none';
    }
  });

  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  //  GRID INIT
  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function buildGrid() {
    const grid = document.getElementById('weeklyGrid');
    grid.innerHTML = '';
    const heads = ['Time','Mon','Tue','Wed','Thu','Fri','Sat','Sun'];
    heads.forEach(h => {
      const d = document.createElement('div');
      d.className = 'g-head';
      d.textContent = h;
      grid.appendChild(d);
    });
    for (let hr = 0; hr < 24; hr++) {
      const lbl = document.createElement('div');
      lbl.className = 'g-head';
      lbl.textContent = `${String(hr).padStart(2,'0')}:00`;
      lbl.style.borderRight = '1px solid var(--border)';
      grid.appendChild(lbl);
      for (let day = 0; day < 7; day++) {
        const c = document.createElement('div');
        c.className = 'g-cell';
        c.dataset.day = day;
        c.dataset.hour = hr;
        c.addEventListener('mousedown', onCellDown);
        c.addEventListener('mouseover', onCellOver);
        c.addEventListener('contextmenu', onCellRight);
        grid.appendChild(c);
      }
    }
  }

  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  //  CELL EVENTS
  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  document.addEventListener('mousedown', () => isDragging = true);
  document.addEventListener('mouseup', () => isDragging = false);
  document.addEventListener('contextmenu', e => { if (e.target.classList.contains('g-cell')) e.preventDefault(); });

  function isLocked(cell) {
    return cell.classList.contains('is-work') || cell.classList.contains('is-sleep') || cell.classList.contains('is-commute');
  }

  function onCellDown(e) {
    if (e.button !== 0) return;
    const c = e.currentTarget;
    if (isLocked(c)) return;
    const act = 'is-' + currentActivity;
    const had = c.classList.contains(act);
    c.className = 'g-cell';
    if (!had) c.classList.add(act);
    updateStats();
  }

  function onCellOver(e) {
    if (!isDragging) return;
    const c = e.currentTarget;
    if (isLocked(c)) return;
    c.className = 'g-cell is-' + currentActivity;
    updateStats();
  }

  function onCellRight(e) {
    e.preventDefault();
    const c = e.currentTarget;
    if (isLocked(c)) return;
    c.className = 'g-cell';
    updateStats();
  }

  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  //  SCHEDULE HELPERS
  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const workMap = {
    'custom':       {s:9, e:12},
    'part-time-20': {s:9, e:13},
    'part-time-25': {s:9, e:14},
    'part-time-30': {s:9, e:15},
    'standard':     {s:9, e:17},
    'extended-45':  {s:8, e:17},
    'extended-50':  {s:7, e:17},
    'long-55':      {s:7, e:18},
    'long-60':      {s:7, e:19},
  };
  const sleepMap = {
    'short':    {s:23, e:6},
    'light':    {s:23, e:6},
    'average':  {s:22, e:6},
    'good':     {s:22, e:6},
    'extended': {s:21, e:6},
  };

  function getWorkDays(arr) {
    // ALL days where work happens (Mon‚ÄìFri for everyone except fully remote, who still work Mon‚ÄìFri)
    // Remote workers just have no commute ‚Äî they still work 5 days
    return [0, 1, 2, 3, 4];
  }

  function getCommuteDays(arr) {
    // Only the days where the person physically travels in
    if (arr === 'remote') return [];
    if (arr.startsWith('hybrid')) {
      return Array.from(document.querySelectorAll('#hybridField input:checked'))
        .map(cb => parseInt(cb.value));
    }
    // Full-time office: all 5 days
    return [0, 1, 2, 3, 4];
  }

  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  //  POPULATE SCHEDULE
  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function populateSchedule(workType, commuteType, sleepType, arr) {
    document.querySelectorAll('.g-cell').forEach(c => c.className = 'g-cell');

    const allWorkDays  = getWorkDays(arr);      // Mon‚ÄìFri always (work happens every day)
    const commuteDays  = getCommuteDays(arr);   // Only days physically in office
    const wh = workMap[workType] || workMap['standard'];
    const sh = sleepMap[sleepType] || sleepMap['average'];

    // Work ‚Äî every weekday regardless of arrangement
    allWorkDays.forEach(day => {
      for (let h = wh.s; h < wh.e; h++) {
        const c = document.querySelector(`[data-day="${day}"][data-hour="${h}"]`);
        if (c) c.classList.add('is-work');
      }
    });

    // Commute ‚Äî only on office/commute days, and only if commute isn't 'none'
    if (commuteType !== 'none' && commuteDays.length > 0) {
      const morningHour = Math.max(0, wh.s - 1);
      const eveningHour = Math.min(23, wh.e);
      commuteDays.forEach(day => {
        const cm = document.querySelector(`[data-day="${day}"][data-hour="${morningHour}"]`);
        const ce = document.querySelector(`[data-day="${day}"][data-hour="${eveningHour}"]`);
        if (cm && !cm.classList.contains('is-work')) cm.classList.add('is-commute');
        if (ce && !ce.classList.contains('is-work')) ce.classList.add('is-commute');
      });
    }

    // Sleep ‚Äî every night
    for (let day = 0; day < 7; day++) {
      for (let h = sh.s; h < 24; h++) {
        const c = document.querySelector(`[data-day="${day}"][data-hour="${h}"]`);
        if (c) c.classList.add('is-sleep');
      }
      for (let h = 0; h < sh.e; h++) {
        const c = document.querySelector(`[data-day="${day}"][data-hour="${h}"]`);
        if (c) c.classList.add('is-sleep');
      }
    }

    updateStats();
  }

  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  //  STATS
  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const COLORS = {
    work:'#1e3a5f', commute:'#e07b1a', sleep:'#6b7280',
    study:'#2d9a57', family:'#e05a7a', social:'#c9981a', other:'#5a9e82'
  };

  function countCells() {
    const counts = {work:0,commute:0,sleep:0,study:0,family:0,social:0,other:0};
    document.querySelectorAll('.g-cell').forEach(c => {
      for (const key of Object.keys(counts)) {
        if (c.classList.contains('is-' + key)) { counts[key]++; break; }
      }
    });
    return counts;
  }

  function updateStats() {
    const counts = countCells();
    const total = Object.values(counts).reduce((a,b)=>a+b,0);
    const free = 168 - total;

    const items = [
      {key:'work',   label:'Work',    color:COLORS.work},
      {key:'commute',label:'Commute', color:COLORS.commute},
      {key:'sleep',  label:'Sleep',   color:COLORS.sleep},
      {key:'study',  label:'Study',   color:COLORS.study},
      {key:'family', label:'Family',  color:COLORS.family},
      {key:'social', label:'Social',  color:COLORS.social},
      {key:'other',  label:'Other',   color:COLORS.other},
    ];

    // Stats bar above grid
    const statsBar = document.getElementById('statsBar');
    if (statsBar) {
      statsBar.classList.add('show');
      statsBar.innerHTML = items.map(i => `
        <div class="sbar-chip">
          <div class="val" style="color:${i.color}">${counts[i.key]}h</div>
          <div class="lbl">${i.label}</div>
        </div>
      `).join('') + `
        <div class="sbar-chip" style="border-color:var(--accent)">
          <div class="val" style="color:var(--accent)">${free}h</div>
          <div class="lbl">Free</div>
        </div>
      `;
    }

    // Overview strip in header (live-updates as you paint)
    const el = id => document.getElementById(id);
    if (el('ov-work')) {
      el('ov-work').textContent    = counts.work + 'h';
      el('ov-commute').textContent = counts.commute + 'h';
      el('ov-sleep').textContent   = counts.sleep + 'h';
      el('ov-free').textContent    = free + 'h';
    }
  }

  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  //  FORM SUBMIT
  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  document.getElementById('plannerForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const ws = document.getElementById('workSchedule');
    const cs = document.getElementById('commuteSchedule');
    const ss = document.getElementById('sleepSchedule');
    const wa = document.getElementById('workArrangement');

    if (!ws.value || !cs.value || !ss.value) {
      alert('Please complete all required fields.');
      return;
    }

    const work = parseFloat(ws.selectedOptions[0].dataset.hours);
    const commute = parseFloat(cs.selectedOptions[0].dataset.hours);
    const sleep = parseFloat(ss.selectedOptions[0].dataset.hours);
    const avail = Math.max(0, 168 - work - commute - sleep);

    // Show overview strip in header
    document.getElementById('ov-work').textContent    = work + 'h';
    document.getElementById('ov-commute').textContent = commute + 'h';
    document.getElementById('ov-sleep').textContent   = sleep + 'h';
    document.getElementById('ov-free').textContent    = avail + 'h';
    document.getElementById('overviewStrip').classList.add('show');

    populateSchedule(ws.value, cs.value, ss.value, wa.value);

    document.getElementById('placeholder').style.display = 'none';
    document.getElementById('calendarContainer').classList.add('show');

    document.getElementById('activitySelect').addEventListener('change', function() {
      currentActivity = this.value;
    });
  });

  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  //  TOOLBAR BUTTONS
  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  document.getElementById('clearBtn').addEventListener('click', () => {
    document.querySelectorAll('.g-cell').forEach(c => {
      if (!isLocked(c)) c.className = 'g-cell';
    });
    updateStats();
  });

  document.getElementById('smartBtn').addEventListener('click', () => {
    // Clear personal first
    document.querySelectorAll('.g-cell').forEach(c => {
      if (!isLocked(c)) c.className = 'g-cell';
    });

    const suggestions = [
      {act:'study',  days:[0,1,2,3,4], hours:[7,8],       w:0.85},
      {act:'study',  days:[0,1,2,3,4], hours:[18,19,20],  w:0.85},
      {act:'study',  days:[5,6],       hours:[9,10,11],   w:0.9},
      {act:'study',  days:[6],         hours:[14,15,16],  w:0.75},
      {act:'family', days:[0,1,2,3,4], hours:[17],        w:0.7},
      {act:'family', days:[6],         hours:[12,13],     w:0.8},
      {act:'social', days:[5],         hours:[19,20,21],  w:0.7},
      {act:'social', days:[6],         hours:[17,18],     w:0.6},
      {act:'other',  days:[5],         hours:[8,9],       w:0.7},
      {act:'other',  days:[2],         hours:[20],        w:0.4},
    ];

    suggestions.forEach(s => {
      s.days.forEach(day => {
        s.hours.forEach(hr => {
          if (Math.random() < s.w) {
            const c = document.querySelector(`[data-day="${day}"][data-hour="${hr}"]`);
            if (c && !isLocked(c) && c.className === 'g-cell') {
              c.classList.add('is-' + s.act);
            }
          }
        });
      });
    });

    updateStats();
  });

  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  //  PRINT / DOWNLOAD
  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  document.getElementById('printBtn').addEventListener('click', () => {
    window.print();
  });

  document.getElementById('downloadBtn').addEventListener('click', () => {
    const days = ['Monday','Tuesday','Wednesday','Thursday','Friday','Saturday','Sunday'];
    const rows = [['Time', ...days]];
    for (let h = 0; h < 24; h++) {
      const row = [`${String(h).padStart(2,'0')}:00`];
      for (let d = 0; d < 7; d++) {
        const c = document.querySelector(`[data-day="${d}"][data-hour="${h}"]`);
        const acts = ['work','commute','sleep','study','family','social','other'];
        let label = '';
        for (const a of acts) {
          if (c && c.classList.contains('is-'+a)) { label = a.charAt(0).toUpperCase()+a.slice(1); break; }
        }
        row.push(label);
      }
      rows.push(row);
    }
    const csv = rows.map(r => r.join(',')).join('\n');
    const blob = new Blob([csv], {type:'text/csv'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = `kcl-study-schedule-${new Date().toISOString().split('T')[0]}.csv`;
    a.click();
  });

  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  //  INIT
  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  initTheme();
  buildGrid();
</script>
</body>
</html>
